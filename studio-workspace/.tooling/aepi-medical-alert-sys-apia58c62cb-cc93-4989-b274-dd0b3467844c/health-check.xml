<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:avio-core="http://www.mulesoft.org/schema/mule/avio-core" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	  xmlns:mongo="http://www.mulesoft.org/schema/mule/mongo"
	  xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/mongo http://www.mulesoft.org/schema/mule/mongo/current/mule-mongo.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/avio-core http://www.mulesoft.org/schema/mule/avio-core/current/mule-avio-core.xsd">

	<sub-flow name="hc-general-health-flow" doc:id="d16bd8f5-cac6-4c1f-8121-9243eaf84a79">
		<try doc:name="Try" doc:id="44177cf1-83da-405d-9e03-7ffe697da237">
			<set-variable value="OK" doc:name="statusCode" doc:id="1c2fe3a6-a69e-4fa7-9741-e1ae9ca00ce3" variableName="statusCode" />
			<error-handler>
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="7beba1ed-ccc9-4218-827f-f106f6710270">
					<avio-core:custom-logger doc:name="ERROR" doc:id="8cde4966-a9c4-4841-a32a-66421a9b118b" config-ref="avio-core-config" message="Health check could not access database" />
					<set-variable value="ERROR" doc:name="statusCode" doc:id="0877ab18-e9bd-45be-8124-afdf03c1dcf0" variableName="statusCode" />
				</on-error-continue>
			</error-handler>
		</try>
		<ee:transform doc:name="Transform Message" doc:id="9f6cc075-ca08-454b-85f2-0fb4175a1b9f">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/java
---
{
  systemName: 'General',
  status: vars.statusCode,
  timeStamp : now() as String {format: 'yyyy-MM-dd HH:mm:ss'}
}
]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
	
	<sub-flow name="hc-db-health-flow" doc:id="67b1db60-8076-424b-89b7-2b3d50bc3a8a" >
		<try doc:name="Try" doc:id="7d980193-f296-4b90-9a85-675ebc3b1500" >
			<set-variable value="OK" doc:name="statusCode" doc:id="b8f5c68b-a6ee-45c7-b89a-09fd4614bde6" variableName="statusCode" />
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="3b2e0883-8a14-47b2-8130-57be3be70805" >
					<avio-core:custom-logger doc:name="ERROR" doc:id="47adf31c-ab21-4d55-abdb-2ed979ad8e2a" config-ref="avio-core-config" message="Health check could not access database" />
					<set-variable value="ERROR" doc:name="statusCode" doc:id="c3508a41-20bb-4830-8b44-9a83b8cf9e71" variableName="statusCode" />
				</on-error-continue>
			</error-handler>
		</try>
		<ee:transform doc:name="Transform Message" doc:id="3cc749f9-40ac-4e92-bd10-812d8eb1efd2">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/java
---
{
  systemName: 'DB',
  status: vars.statusCode,
  timeStamp : now() as String {format: 'yyyy-MM-dd HH:mm:ss'}
}
]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
</mule>
